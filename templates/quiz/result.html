{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      
      <div class="card bg-black text-light border-secondary shadow-lg">
        <div class="card-header border-secondary text-center py-3">
          <h4 class="mb-0">Resultado del Examen</h4>
          <small class="text-muted">{{ module.title }}</small>
        </div>

        <div class="card-body text-center p-4">
          {% if attempt.passed %}
            <div class="display-1 text-success mb-3"><i class="bi bi-check-circle-fill"></i></div>
            <div class="alert alert-success border-success">
              <h3 class="alert-heading">¡Aprobado!</h3>
              <p class="mb-0 fs-5">Tu puntaje: <strong>{{ attempt.score }}/10</strong></p>
              <small>(Mínimo requerido: 8/10)</small>
            </div>
            <p class="mt-3">¡Felicitaciones! Tu certificado se está generando.</p>
          {% else %}
            <div class="display-1 text-danger mb-3"><i class="bi bi-x-circle-fill"></i></div>
            <div class="alert alert-danger border-danger">
              <h3 class="alert-heading">No aprobado</h3>
              <p class="mb-0 fs-5">Tu puntaje: <strong>{{ attempt.score }}/10</strong></p>
              <small>(Mínimo requerido: 8/10)</small>
            </div>
            <p class="mt-3">Revisá los conceptos en el chat con Ergobot antes de volver a intentar.</p>
          {% endif %}

          <hr class="border-secondary my-4">

          <div class="row text-secondary small mb-4">
            <div class="col-6 border-end border-secondary">
              <div>Intentos usados hoy</div>
              <strong class="text-light fs-5">{{ state.attempts_used }} / 3</strong>
            </div>
            <div class="col-6">
              <div>Intentos restantes</div>
              <strong class="text-light fs-5">{{ attempts_left }}</strong>
            </div>
          </div>

          {% if state.lockout_until %}
            <div class="alert alert-warning d-flex align-items-center justify-content-center">
              <i class="bi bi-clock-history me-2"></i>
              Bloqueado hasta: {{ state.lockout_until|date:"d/m/Y H:i" }}
            </div>
          {% endif %}

          {% if state.retake_available_at and not state.lockout_until %}
             <div class="alert alert-info small">
              Próximo examen disponible: {{ state.retake_available_at|date:"d/m/Y H:i" }}
            </div>
          {% endif %}

          <div class="d-grid gap-2 mt-3">
            <a class="btn btn-outline-light" href="{% url 'training_home' %}">
              <i class="bi bi-arrow-left me-2"></i>Volver a la capacitación
            </a>

            {% if not locked_now %}
              <form action="{% url 'quiz_retake' module.slug %}" method="POST" class="d-grid">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary">
                  <i class="bi bi-arrow-repeat me-2"></i>Intentar nuevamente
                </button>
              </form>
            {% else %}
              <button class="btn btn-secondary" disabled>
                <i class="bi bi-lock-fill me-2"></i>Examen bloqueado temporalmente
              </button>
            {% endif %}
          </div>

        </div>
      </div>

    </div>
  </div>
</div>
{% endblock %}